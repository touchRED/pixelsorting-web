var gui = new dat.GUI();

var sortedImg;
var sorted = false;
var original;
var pix = [];

function Controls(){
	this.imageURL = "";
	this.imageName = "";
	this.Upload = function(){
		document.querySelector('input[type=file]').click();
	}
	this.Create = function(){
		var self = this;
		loadImage(this.imageURL, function(img){

			// original = img;
			// image(img, 50, 0, 150, (150 * img.height)/img.width);

			sortNoWorker(img);
		});
	}
	this.Save = function(){
		sortedImg.save("sorted", "png");
	}
}

var ctrl = new Controls();
var create = gui.addFolder("Create");
// create.add(ctrl, 'imageName').listen();
create.add(ctrl, 'Upload');
create.add(ctrl, 'Create');
create.add(ctrl, 'Save');

function uploadImg(){
	var file = document.querySelector('input[type=file]').files[0];
	var reader = new FileReader();

	reader.onload = function(event) {
		ctrl.imageURL = event.target.result;
		ctrl.imageName = file.name;
		loadImage(ctrl.imageURL, function(img){
			original = img;
		});
	}

	reader.readAsDataURL(file);
}

function sorter(a, b){
	return ((a.levels[3] << 24) + (a.levels[0] << 16) + (a.levels[1] << 8) + a.levels[2]) - ((b.levels[3] << 24) + (b.levels[0] << 16) + (b.levels[1] << 8) + b.levels[2]);
}

function sortNoWorker(img){
	sortedImg = createImage(img.width, img.height);
	var tmp = [];

	img.loadPixels();
	for (var i = 0; i < 4*(img.width*img.height); i+=4){
		tmp.push(color(img.pixels[i], img.pixels[i+1], img.pixels[i+2], img.pixels[i+3]));
	}

	tmp.sort(sorter);

	sortedImg.loadPixels();
	var k = 0;
	for (var i = 0; i < 4*(img.width*img.height); i+=4){

		sortedImg.pixels[i] = red(tmp[k]);
		sortedImg.pixels[i + 1] = green(tmp[k]);
		sortedImg.pixels[i + 2] = blue(tmp[k]);
		sortedImg.pixels[i + 3] = alpha(tmp[k]);
		k++;
	}
	sortedImg.updatePixels();
	sorted = true;

	// original = sortedImg;

}

function preload(){

	original = createImage(5,5);

}

function setup(){

	createCanvas(windowWidth, windowHeight);

}

function draw(){
	clear();
	var padding;

	if(original.width > original.height){
		padding = (windowHeight - (windowWidth/2 * original.height / original.width)) / 2;

		image(original, 0, padding, windowWidth/2, (windowWidth/2 * original.height) / original.width);
	}else{
		padding = (windowWidth/2 - (windowHeight * original.width) / original.height) / 2;

		image(original, padding, 0, (windowHeight * original.width) / original.height, windowHeight);
	}

	if(sorted){
		if(sortedImg.width > sortedImg.height){
			padding = (windowHeight - (windowWidth/2 * sortedImg.height / sortedImg.width)) / 2;

			image(sortedImg, windowWidth/2, padding, windowWidth/2, (windowWidth/2 * sortedImg.height)/sortedImg.width);
		}else{
			padding = (windowWidth/2 - (windowHeight * sortedImg.width)/sortedImg.height) / 2;

			image(sortedImg, padding + windowWidth/2, 0, (windowHeight * sortedImg.width)/sortedImg.height, windowHeight);
		}
	}
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJtYWluLmpzIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBndWkgPSBuZXcgZGF0LkdVSSgpO1xuXG52YXIgc29ydGVkSW1nO1xudmFyIHNvcnRlZCA9IGZhbHNlO1xudmFyIG9yaWdpbmFsO1xudmFyIHBpeCA9IFtdO1xuXG5mdW5jdGlvbiBDb250cm9scygpe1xuXHR0aGlzLmltYWdlVVJMID0gXCJcIjtcblx0dGhpcy5pbWFnZU5hbWUgPSBcIlwiO1xuXHR0aGlzLlVwbG9hZCA9IGZ1bmN0aW9uKCl7XG5cdFx0ZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbdHlwZT1maWxlXScpLmNsaWNrKCk7XG5cdH1cblx0dGhpcy5DcmVhdGUgPSBmdW5jdGlvbigpe1xuXHRcdHZhciBzZWxmID0gdGhpcztcblx0XHRsb2FkSW1hZ2UodGhpcy5pbWFnZVVSTCwgZnVuY3Rpb24oaW1nKXtcblxuXHRcdFx0Ly8gb3JpZ2luYWwgPSBpbWc7XG5cdFx0XHQvLyBpbWFnZShpbWcsIDUwLCAwLCAxNTAsICgxNTAgKiBpbWcuaGVpZ2h0KS9pbWcud2lkdGgpO1xuXG5cdFx0XHRzb3J0Tm9Xb3JrZXIoaW1nKTtcblx0XHR9KTtcblx0fVxuXHR0aGlzLlNhdmUgPSBmdW5jdGlvbigpe1xuXHRcdHNvcnRlZEltZy5zYXZlKFwic29ydGVkXCIsIFwicG5nXCIpO1xuXHR9XG59XG5cbnZhciBjdHJsID0gbmV3IENvbnRyb2xzKCk7XG52YXIgY3JlYXRlID0gZ3VpLmFkZEZvbGRlcihcIkNyZWF0ZVwiKTtcbi8vIGNyZWF0ZS5hZGQoY3RybCwgJ2ltYWdlTmFtZScpLmxpc3RlbigpO1xuY3JlYXRlLmFkZChjdHJsLCAnVXBsb2FkJyk7XG5jcmVhdGUuYWRkKGN0cmwsICdDcmVhdGUnKTtcbmNyZWF0ZS5hZGQoY3RybCwgJ1NhdmUnKTtcblxuZnVuY3Rpb24gdXBsb2FkSW1nKCl7XG5cdHZhciBmaWxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbdHlwZT1maWxlXScpLmZpbGVzWzBdO1xuXHR2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcblxuXHRyZWFkZXIub25sb2FkID0gZnVuY3Rpb24oZXZlbnQpIHtcblx0XHRjdHJsLmltYWdlVVJMID0gZXZlbnQudGFyZ2V0LnJlc3VsdDtcblx0XHRjdHJsLmltYWdlTmFtZSA9IGZpbGUubmFtZTtcblx0XHRsb2FkSW1hZ2UoY3RybC5pbWFnZVVSTCwgZnVuY3Rpb24oaW1nKXtcblx0XHRcdG9yaWdpbmFsID0gaW1nO1xuXHRcdH0pO1xuXHR9XG5cblx0cmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7XG59XG5cbmZ1bmN0aW9uIHNvcnRlcihhLCBiKXtcblx0cmV0dXJuICgoYS5sZXZlbHNbM10gPDwgMjQpICsgKGEubGV2ZWxzWzBdIDw8IDE2KSArIChhLmxldmVsc1sxXSA8PCA4KSArIGEubGV2ZWxzWzJdKSAtICgoYi5sZXZlbHNbM10gPDwgMjQpICsgKGIubGV2ZWxzWzBdIDw8IDE2KSArIChiLmxldmVsc1sxXSA8PCA4KSArIGIubGV2ZWxzWzJdKTtcbn1cblxuZnVuY3Rpb24gc29ydE5vV29ya2VyKGltZyl7XG5cdHNvcnRlZEltZyA9IGNyZWF0ZUltYWdlKGltZy53aWR0aCwgaW1nLmhlaWdodCk7XG5cdHZhciB0bXAgPSBbXTtcblxuXHRpbWcubG9hZFBpeGVscygpO1xuXHRmb3IgKHZhciBpID0gMDsgaSA8IDQqKGltZy53aWR0aCppbWcuaGVpZ2h0KTsgaSs9NCl7XG5cdFx0dG1wLnB1c2goY29sb3IoaW1nLnBpeGVsc1tpXSwgaW1nLnBpeGVsc1tpKzFdLCBpbWcucGl4ZWxzW2krMl0sIGltZy5waXhlbHNbaSszXSkpO1xuXHR9XG5cblx0dG1wLnNvcnQoc29ydGVyKTtcblxuXHRzb3J0ZWRJbWcubG9hZFBpeGVscygpO1xuXHR2YXIgayA9IDA7XG5cdGZvciAodmFyIGkgPSAwOyBpIDwgNCooaW1nLndpZHRoKmltZy5oZWlnaHQpOyBpKz00KXtcblxuXHRcdHNvcnRlZEltZy5waXhlbHNbaV0gPSByZWQodG1wW2tdKTtcblx0XHRzb3J0ZWRJbWcucGl4ZWxzW2kgKyAxXSA9IGdyZWVuKHRtcFtrXSk7XG5cdFx0c29ydGVkSW1nLnBpeGVsc1tpICsgMl0gPSBibHVlKHRtcFtrXSk7XG5cdFx0c29ydGVkSW1nLnBpeGVsc1tpICsgM10gPSBhbHBoYSh0bXBba10pO1xuXHRcdGsrKztcblx0fVxuXHRzb3J0ZWRJbWcudXBkYXRlUGl4ZWxzKCk7XG5cdHNvcnRlZCA9IHRydWU7XG5cblx0Ly8gb3JpZ2luYWwgPSBzb3J0ZWRJbWc7XG5cbn1cblxuZnVuY3Rpb24gcHJlbG9hZCgpe1xuXG5cdG9yaWdpbmFsID0gY3JlYXRlSW1hZ2UoNSw1KTtcblxufVxuXG5mdW5jdGlvbiBzZXR1cCgpe1xuXG5cdGNyZWF0ZUNhbnZhcyh3aW5kb3dXaWR0aCwgd2luZG93SGVpZ2h0KTtcblxufVxuXG5mdW5jdGlvbiBkcmF3KCl7XG5cdGNsZWFyKCk7XG5cdHZhciBwYWRkaW5nO1xuXG5cdGlmKG9yaWdpbmFsLndpZHRoID4gb3JpZ2luYWwuaGVpZ2h0KXtcblx0XHRwYWRkaW5nID0gKHdpbmRvd0hlaWdodCAtICh3aW5kb3dXaWR0aC8yICogb3JpZ2luYWwuaGVpZ2h0IC8gb3JpZ2luYWwud2lkdGgpKSAvIDI7XG5cblx0XHRpbWFnZShvcmlnaW5hbCwgMCwgcGFkZGluZywgd2luZG93V2lkdGgvMiwgKHdpbmRvd1dpZHRoLzIgKiBvcmlnaW5hbC5oZWlnaHQpIC8gb3JpZ2luYWwud2lkdGgpO1xuXHR9ZWxzZXtcblx0XHRwYWRkaW5nID0gKHdpbmRvd1dpZHRoLzIgLSAod2luZG93SGVpZ2h0ICogb3JpZ2luYWwud2lkdGgpIC8gb3JpZ2luYWwuaGVpZ2h0KSAvIDI7XG5cblx0XHRpbWFnZShvcmlnaW5hbCwgcGFkZGluZywgMCwgKHdpbmRvd0hlaWdodCAqIG9yaWdpbmFsLndpZHRoKSAvIG9yaWdpbmFsLmhlaWdodCwgd2luZG93SGVpZ2h0KTtcblx0fVxuXG5cdGlmKHNvcnRlZCl7XG5cdFx0aWYoc29ydGVkSW1nLndpZHRoID4gc29ydGVkSW1nLmhlaWdodCl7XG5cdFx0XHRwYWRkaW5nID0gKHdpbmRvd0hlaWdodCAtICh3aW5kb3dXaWR0aC8yICogc29ydGVkSW1nLmhlaWdodCAvIHNvcnRlZEltZy53aWR0aCkpIC8gMjtcblxuXHRcdFx0aW1hZ2Uoc29ydGVkSW1nLCB3aW5kb3dXaWR0aC8yLCBwYWRkaW5nLCB3aW5kb3dXaWR0aC8yLCAod2luZG93V2lkdGgvMiAqIHNvcnRlZEltZy5oZWlnaHQpL3NvcnRlZEltZy53aWR0aCk7XG5cdFx0fWVsc2V7XG5cdFx0XHRwYWRkaW5nID0gKHdpbmRvd1dpZHRoLzIgLSAod2luZG93SGVpZ2h0ICogc29ydGVkSW1nLndpZHRoKS9zb3J0ZWRJbWcuaGVpZ2h0KSAvIDI7XG5cblx0XHRcdGltYWdlKHNvcnRlZEltZywgcGFkZGluZyArIHdpbmRvd1dpZHRoLzIsIDAsICh3aW5kb3dIZWlnaHQgKiBzb3J0ZWRJbWcud2lkdGgpL3NvcnRlZEltZy5oZWlnaHQsIHdpbmRvd0hlaWdodCk7XG5cdFx0fVxuXHR9XG59XG4iXSwiZmlsZSI6Im1haW4uanMifQ==

//# sourceMappingURL=main.min.js.map
